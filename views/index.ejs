<!DOCTYPE html>
<html lang="en" xmlns:html="http://www.w3.org/1999/html">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="Mosaddek">
  <meta name="keyword" content="FlatLab, Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
  <link rel="shortcut icon" href="/images/favicon.png">

  <title>My Note</title>

  <!-- Bootstrap core CSS -->
  <link href="/stylesheets/bootstrap.min.css" rel="stylesheet">
  <link href="/stylesheets/bootstrap-reset.css" rel="stylesheet">
  <!--external css-->
  <link href="/stylesheets/font-awesome.css" rel="stylesheet" />
  <link href="/stylesheets/tasks.css" rel="stylesheet">


  <!-- Custom styles for this template -->
  <link href="/stylesheets/style.css" rel="stylesheet">
  <link href="/stylesheets/style-responsive.css" rel="stylesheet" />
  <link rel="stylesheet" href="/stylesheets/owl.carousel.css" type="text/css">
  <!--图标样式-->
  <link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap.min.css"/>

  <script src="/plugins/ckeditor/ckeditor.js"></script>

  <style>
    .selected{font-weight:bold; background-color:#c7cbd4;}
  </style>

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 tooltipss and media queries -->
  <!--[if lt IE 9]>
  <!--<script src="js/html5shiv.js"></script>-->
  <!--<script src="js/respond.min.js"></script>-->
  <![endif]-->
</head>

<body class="login-body" style="background-image: url('/images/back3.jpg');background-size: 100%">

<section id="container" >
  <!--header start-->
  <header class="header white-bg">

    <div class="sidebar-toggle-box">
      <div data-original-title="Toggle Navigation" data-placement="right" class="fa fa-reorder icon-reorder tooltips"></div>
    </div>

    <a href="/" class="logo"><span><%= title %></span></a>

    <div class="nav notify-row" id="top_menu">
      <!--  notification start -->
      <ul class="nav top-menu">
        <!-- settings start -->
        <li class="dropdown">
          <a data-toggle="dropdown" class="dropdown-toggle" href="#">
            <i class="fa fa-tasks" aria-hidden="true"></i>
            <span class="badge bg-success">6</span>
          </a>
          <ul class="dropdown-menu extended tasks-bar">
            <div class="notify-arrow notify-arrow-green"></div>
            <li>
              <p class="green">You have 6 pending tasks</p>
            </li>
          </ul>
        </li>
        <!-- settings end -->
        <!-- inbox dropdown start-->
        <li id="header_inbox_bar" class="dropdown">
          <a data-toggle="dropdown" class="dropdown-toggle" href="#">
            <i class="fa fa-envelope" aria-hidden="true"></i>
            <span class="badge bg-important">5</span>
          </a>
          <ul class="dropdown-menu extended inbox">
            <div class="notify-arrow notify-arrow-red"></div>
            <li>
              <p class="red">You have 5 new messages</p>
            </li>
          </ul>
        </li>
        <!-- inbox dropdown end -->
        <!-- notification dropdown start-->
        <li id="header_notification_bar" class="dropdown">
          <a data-toggle="dropdown" class="dropdown-toggle" href="#">

            <i class="fa fa-bell-o" aria-hidden="true"></i>
            <span class="badge bg-warning">7</span>
          </a>
          <ul class="dropdown-menu extended notification">
            <div class="notify-arrow notify-arrow-yellow"></div>
            <li>
              <p class="yellow">You have 7 new notifications</p>
            </li>
          </ul>
        </li>
        <!-- notification dropdown end -->
      </ul>
      <!--  notification end -->
    </div>
    <div class="top-nav ">
      <!--search & user info start-->
      <ul class="nav pull-right top-menu">
        <li>
          <input type="text" class="form-control search" placeholder="Search">
        </li>
        <!-- user login dropdown start-->
        <li class="dropdown">
          <a data-toggle="dropdown" class="dropdown-toggle" href="#">
            <img alt="" src="/images/avatar-mini.jpg">
            <span class="username"> <%= user.username %> </span>
            <b class="caret"></b>
          </a>
          <ul class="dropdown-menu extended logout">
            <div class="log-arrow-up"></div>
            <li><a href="#"><i class=" fa fa-suitcase"></i>Profile</a></li>
            <li><a href="#"><i class="fa fa-cog"></i> Settings</a></li>
            <li><a href="#"><i class="fa fa-bell-o"></i> Notification</a></li>
            <li><a href="/"><i class="fa fa-key"></i> Log Out</a></li>
          </ul>
        </li>
        <!-- user login dropdown end -->
      </ul>
      <!--search & user info end-->
    </div>
  </header>

  <!--sidebar start-->
  <aside>

    <div id="sidebar"  class="nav-collapse ">

      <!-- sidebar menu start-->
      <ul class="sidebar-menu" id="nav-accordion">

        <li class="sub-menu">
          <a class="active" href="/" >
            <i class="fa fa-book" aria-hidden="true"></i>
            <span>我的笔记本</span>
          </a>

           <ul class="sub" id="notebook_ul" role="menu">
              <%note.forEach(function(note2){%>
             <li class="sub-menu"  role="presentation" id="context" data-toggle="context" data-target="#context-menu" onmousedown="right('<%=note2.notebookID%>','<%=note2.title%>','<%=note2.tag%>')">
               <a href="/index/showPageMenu/<%=note2.notebookID%>">
                 <i class="fa fa-book" aria-hidden="true"></i>
                 <span id="<%=note2.notebookID%>"><%=note2.title%></span>
               </a>
             </li>
              <%})%>
             <li role="presentation" class="divider"></li>
             <li class="sub-menu" role="presentation">
               <a data-toggle="modal" href="#addNotebookModal" onclick="getNotebookTags()">
                 <i class="fa fa-coffee" aria-hidden="true"></i>
                 <span>添加笔记本</span>
               </a>
             </li>
            </ul>

        </li>

        <li class="sub-menu">
          <a href="#" class="" >
            <i class="fa fa-envelope"></i>
            <span>好友圈</span>
          </a>
          <ul class="sub">
            <li>
              <a href="/index/myFriends">
              <i class="fa fa-thumbs-up" aria-hidden="true"></i>
              <span>我的好友</span>
            </a>
            </li>
            <li><a href="/index/sharedPage">
              <i class="fa fa-share-alt" aria-hidden="true"></i>
              <span>分享笔记</span>
            </a></li>
          </ul>
        </li>

        <li>
          <a href="/index/tagManage">
            <i class="fa fa-tags" aria-hidden="true"></i>
            <span>标签管理</span>
            <span class="label label-danger pull-right mail-info">2</span>
          </a>
        </li>

        <li>
          <a href="/index/myInfo">
            <i class="fa fa-cog" aria-hidden="true"></i>
            <span >我的信息</span>
            <span class="label label-danger pull-right mail-info">2</span>
          </a>
        </li>


      </ul>

      <div id="context-menu">
        <ul class="dropdown-menu" role="menu">
          <li data-toggle="modal" href="#deleteNotebookModal" onclick="setDataToDeleteNotebookDialog();$('#deleteNotebookModal').modal('show');"><a>删除</a></li>
          <li data-toggle="modal" href="#deleteNotebookModal" onclick="$('#modifyNotebookModal').modal('show');"><a>修改</a></li>
          <li class="hidden"><a id="delete_id">Another action</a></li>
          <li class="hidden"><a id="delete_title">Another action</a></li>
        </ul>
      </div>

    </div>
  </aside>
  <!--sidebar end-->

  <!--main content start-->
  <section id="main-content" >
    <section class="wrapper">
      <!--state overview start-->
      <div class="row state-overview">

      </div>
      <!--state overview end-->

      <div class="row">
        <div class="col-lg-12">
          <!--timeline start-->
          <section class="panel" style="height: 560px">
            <div class="panel-body">

              <div class="mail-box">
                <!--mail-box-->

                <aside class="sm-side" id="pageMenuBody">
                  <div class="user-head">
                    <a href="javascript:;" class="inbox-avatar">
                      <img src="/images/avatar-mini.jpg" class="img-responsive" alt="">
                    </a>

                    <div class="user-name">
                      <h5 align="center"><a href="#"><%= user.username %></a></h5>
                      <span><a href="#"><%= user.email %></a></span>
                    </div>
                  </div>
                  <div>

                    <div class="inbox-body" style="height: 430px">
                      <button class="btn btn-basic btn-sm pull-left" style="display: none" id="showMenuBT2" onclick="showMenu()">
                        <i class="fa fa-arrow-left">返回</i>
                      </button>
                      <a class="btn btn-compose" data-toggle="modal" href="#addPageModal" onclick="getPageTags()">
                        Add Page
                      </a>
                      <!-- Modal -->
                      <ul class="inbox-nav inbox-divider" id="pageMenu">
                        <%pageMenu.forEach(function(page){%>

                        <li class="sub-menu" role="presentation" id="context2" data-toggle="context" data-target="#context-menu2" onmousedown="right2('<%=page.pageID%>','<%=page.title%>')" onclick="showPageContent('<%=page.pageID%>')">
                          <!--/index/showPageContent/<%=page.pageID%>-->
                          <a><i class="fa fa-book"> &nbsp;&nbsp;<%=page.title%></i></a>
                        </li>
                          <%})%>
                      </ul>

                    </div>
                  </div>
                </aside>

                <aside class="lg-side">
                  <div class="inbox-head">

                    <h3 class="pull-left">Page</h3>
                    <!--<p id="status"></p>-->
                    <!--&lt;!&ndash;'Req_ajax("client get", "get")'&ndash;&gt;-->
                    <!--<button onclick=getData()>点我</button>-->
                    <form class="pull-right position" action="#">
                      <button type="button" class="btn btn-primary" id="sharePageBT" style="display:none" onclick="showFriendList()">Share</button>
                      <button type="button" class="btn btn-primary" id="updateNoteBT" style="display: none">Update</button>
                      <button type="button" class="btn btn-primary" id="downloadToPdfBT" style="display: none" onclick="exportPDF()" >Print To PDF</button>
                      <button type="button" class="btn btn-primary" id="showMenuBT" data-toggle="modal" href="#backWarningModal" style="display: none">Return</button>
                    </form>
                  </div>
                  <div class="inbox-body" id="notePanel">
                    <!--<img src="/images/gallery/1.jpg">-->
                    <div class="panel">
                      <div class="panel-body" style="background:#dcdcdc;font-size:14px;" id="noteContent" >
                        <%=pageContent.content%>
                      </div>
                    </div>
                  </div>

                  <div id="writeNotePanel" class="content writeNote-section">

                    <div class="panel">
                      <div class="panel-body">
                        <form style="color: black">
                          <label for="newPageTitle" class="col-sm-2 control-label">笔记名称</label>
                          <div class="col-sm-10">
                            <input type="text" class="form-control" id="newPageTitle">
                          </div>

                          <textarea name="editor1" class="ckeditor" id="editor1" rows="10" cols="80">
                            <%=pageContent.content%>
                          </textarea>

                        </form>

                        <div class="btn-group">
                          <button class="btn btn-success" id="savePageBT" onclick="savePage('<%=pageContent.pageID%>')">保存</button>
                          <button id="calcelSavePageBT" class="btn btn-default" >截屏</button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div id="context-menu2">
                    <ul class="dropdown-menu" role="menu">
                      <li data-toggle="modal" href="#deleteNotebookModal" onclick="setDataToDeletePageDialog();$('#deletePageModal').modal('show');"><a>删除</a></li>
                      <li class="hidden"><a id="delete_pageID">Another action</a></li>
                      <li class="hidden"><a id="delete_pageTitle">Another action</a></li>
                    </ul>
                  </div>

                </aside>


              </div>


              <div class="modal fade" id="addPageModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      <h4 class="modal-title">Add Page</h4>
                    </div>
                    <div class="modal-body">
                      <form class="form-horizontal" role="form">
                        <div class="form-group">
                          <label  class="col-lg-3 control-label">Page Title</label>
                          <div class="col-lg-9">
                            <input type="text" class="form-control" id="page_title" placeholder="">
                          </div>
                        </div>
                        <div class="form-group">
                          <label  class="col-lg-3 control-label">Page Tag</label>
                          <div class="col-lg-7">
                            <!--<input type="text" class="form-control" id="page_tag" placeholder="">-->
                            <select class="form-control" id="page_tag">

                            </select>
                          </div>
                          <div class="col-lg-2">
                            <a class="btn btn-primary btn-sm" data-toggle="modal" href="#addPageTagModal">Add</a>
                          </div>
                        </div>

                        <div class="form-group">
                          <div class="col-lg-12">
                            <button type="button" class="btn btn-default btn-lg btn-block" onclick="addPage()">Create</button>
                          </div>
                        </div>
                      </form>
                    </div>
                  </div><!-- /.modal-content -->
                </div><!-- /.modal-dialog -->
              </div><!-- /.modal -->

              <div class="modal fade" id="addNotebookModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      <h4 class="modal-title">Add Notebook</h4>
                    </div>
                    <div class="modal-body">
                      <form class="form-horizontal" role="form">
                        <div class="form-group">
                          <label  class="col-lg-3 control-label">Notebook Title</label>
                          <div class="col-lg-9">
                            <input type="text" class="form-control" id="notebook_title" placeholder="">
                          </div>
                        </div>
                        <div class="form-group">
                          <label  class="col-lg-3 control-label">Notebook Tag</label>
                          <div class="col-lg-7">
                            <select class="form-control" id="notebook_tag">

                            </select>
                          </div>
                          <div class="col-lg-2">
                            <a class="btn btn-primary btn-sm" data-toggle="modal" href="#addNotebookTagModal">Add</a>
                          </div>
                        </div>

                        <div class="form-group">
                          <div class="col-lg-12">
                            <button type="button" class="btn btn-default btn-lg btn-block" onclick="addNotebook()">Create</button>
                          </div>
                        </div>
                      </form>
                    </div>
                  </div><!-- /.modal-content -->
                </div><!-- /.modal-dialog -->
              </div><!-- /.modal -->

              <div class="modal fade" id="deleteNotebookModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-body">是否确认删除笔记：<code id="delete_notebookTitle"></code>?</div>
                    <p class="hidden" id="delete_notebookID"></p>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-primary" onclick="deleteNotebook()">删除</button>
                      <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    </div>
                  </div><!-- /.modal-content -->
                </div><!-- /.modal-dialog -->
              </div>

              <div class="modal fade" id="deletePageModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-body">是否确认删除笔记：<code id="delete_pageTitle2"></code>?</div>
                    <p class="hidden" id="delete_pageID2"></p>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-primary" onclick="deletePage()">删除</button>
                      <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    </div>
                  </div><!-- /.modal-content -->
                </div><!-- /.modal-dialog -->
              </div>

              <div class="modal fade" id="modifyNotebookModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      <h4 class="modal-title">Modify Notebook</h4>
                    </div>
                    <div class="modal-body">
                      <form class="form-horizontal" role="form">
                        <div class="form-group">
                          <label  class="col-lg-3 control-label">Notebook Title</label>
                          <div class="col-lg-9">
                            <input type="text" class="form-control" id="modify_notebook_title" name="modify_notebook_title" placeholder="">
                          </div>
                        </div>
                        <div class="form-group">
                          <label  class="col-lg-3 control-label">Tag</label>
                          <div class="col-lg-9">
                            <input type="text" class="form-control" id="modify_notebook_tag" name="modify_notebook_tag" placeholder="">
                          </div>
                        </div>
                        <p class="hidden" id="modify_notebookID"></p>
                        <div class="form-group">
                          <div class="col-lg-12">
                            <button type="button" class="btn btn-default btn-lg btn-block" onclick="modifyNotebook()">Modify</button>
                          </div>
                        </div>
                      </form>
                    </div>
                  </div><!-- /.modal-content -->
                </div><!-- /.modal-dialog -->
              </div><!-- /.modal -->

              <div class="modal fade" id="addPageTagModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      <h4 class="modal-title">Add Tag of Page</h4>
                    </div>
                    <div class="modal-body">
                      <form class="form-horizontal" role="form">
                        <div class="form-group">
                          <label  class="col-lg-3 control-label">Page Tag</label>
                          <div class="col-lg-9">
                            <input type="text" class="form-control" id="page_newTag" placeholder="">
                          </div>
                        </div>
                        <div class="form-group">
                          <div class="col-lg-12">
                            <button type="button" class="btn btn-default btn-lg btn-block" onclick="addPageTag()">Create</button>
                          </div>
                        </div>
                      </form>
                    </div>
                  </div><!-- /.modal-content -->
                </div><!-- /.modal-dialog -->
              </div><!-- /.modal -->

              <div class="modal fade" id="addNotebookTagModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      <h4 class="modal-title">Add Tag of Notebook</h4>
                    </div>
                    <div class="modal-body">
                      <form class="form-horizontal" role="form">
                        <div class="form-group">
                          <label  class="col-lg-3 control-label">Notebook Tag</label>
                          <div class="col-lg-9">
                            <input type="text" class="form-control" id="notebook_newTag" placeholder="">
                          </div>
                        </div>
                        <div class="form-group">
                          <div class="col-lg-12">
                            <button type="button" class="btn btn-default btn-lg btn-block" onclick="addNotebookTag()">Create</button>
                          </div>
                        </div>
                      </form>
                    </div>
                  </div><!-- /.modal-content -->
                </div><!-- /.modal-dialog -->
              </div><!-- /.modal -->

              <div class="modal fade" id="friendListModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog" style="width: 460px;">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                      <h4 class="modal-title">我的好友</h4>
                    </div>
                    <div class="modal-body">
                      <section class="panel tasks-widget">

                        <div class="panel-body">

                          <div class="task-content">

                            <ul class="task-list" id="friendUl">
                            </ul>
                          </div>

                          <div class="row">
                            <div class="form-group">
                              <label class="col-md-4 control-label" style="text-align:center;font-size: 16px">权限</label>
                              <div class="col-md-8">
                                <select class="form-control" id="privilege_tag">
                                  <option>只读</option>
                                  <option>读写</option>
                                </select>
                              </div>
                            </div>
                          </div>

                          <br>
                          <div class="add-task-row">
                            <button class="btn btn-success btn-block" onclick="sharePage()">分享给Ta</button>
                          </div>
                        </div>
                      </section>

                    </div>
                  </div><!-- /.modal-content -->
                </div><!-- /.modal-dialog -->
              </div><!-- /.modal -->

              <div class="modal fade" id="backWarningModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-body">若现在离开，您的输入将不会被保存！是否确认离开？</div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-primary" onclick="showMenu()">离开</button>
                      <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    </div>
                  </div><!-- /.modal-content -->
                </div><!-- /.modal-dialog -->
              </div>

              <div class="clearfix">&nbsp;</div>
            </div>
          </section>
          <!--timeline end-->
        </div>
      </div>

      <div>
      </div>

    </section>
  </section>
  <!--main content end-->

  <!--footer start-->

  <!--footer end-->
</section>

<!-- js placed at the end of the document so the pages load faster -->
<script src="/javascripts/jquery-3.2.1.min.js"></script>
<script src="/javascripts/bootstrap.min.js"></script>
<script class="include" type="text/javascript" src="/javascripts/jquery.dcjqaccordion.2.7.js"></script>
<script src="/javascripts/owl.carousel.js" ></script>
<script src="/javascripts/jquery.scrollTo.min.js"></script>
<script src="/javascripts/jquery.nicescroll.js" type="text/javascript"></script>

<script src="/javascripts/jquery.customSelect.min.js" ></script>
<script src="/javascripts/respond.min.js" ></script>
<script src="/plugins/bootstrap-contextmenu.js"></script>

<!--common script for all pages-->
<script src="/javascripts/common-scripts.js"></script>

<script src="/javascripts/jspdf.debug.js"></script>
<script src="/javascripts/html2canvas.js"></script>

<script>

    //owl carousel
    $(document).ready(function() {
        $("#owl-demo").owlCarousel({
            navigation : true,
            slideSpeed : 300,
            paginationSpeed : 400,
            singleItem : true,
            autoPlay:true

        });
    });

    //custom select box

    $(function(){
        $('select.styled').customSelect();
    });

</script>


<script>
    $("#updateNoteBT").click(function(){
        $("#notePanel").slideUp("slow");
        $("#writeNotePanel").slideDown("slow");
//        $("#sidebar").animate({width: 'toggle'}, "slow");
        $("#sidebar").hide();
        $("#main-content").animate({'margin-left': '0px'}, "slow");
        $("#pageMenuBody").animate({'width': '18%'}, "slow");
//        $("#newPageTitle").val("sdfdsf");
//        getElementByValue("<%=pageContent.title%>");
        $("#updateNoteBT").hide();
        $('#downloadToPdfBT').hide();
        $('#sharePageBT').hide();
        $("#showMenuBT").show();
    });

</script>

<script>
    function getElementByValue(value) {
        var liList = document.getElementById("pageMenu").getElementsByTagName("li");
        for(var i=0;i<liList.length;i++) {
            if(liList[i].innerText.trim()==value) {
                var index = i + 1;
                $("ul li").removeClass("selected");
                $( "#pageMenu li:nth-child("+ index +")" ).addClass("selected");
            }
        }
    }
</script>


<script>
  function addNotebook() {
      $.ajax({
          data: {
              title: document.getElementById("notebook_title").value,
              tag: $('#notebook_tag').children('option:selected').val()
          },
          url: "/index/addNotebook",
          dataType: 'json',
//                        async: false,
          contentType: 'application/json;charset=UTF-8',
          cache: false,
          timeout: 0,
          type: 'get',    // 如果要使用GET方式，则将此处改为'get'
          headers: {
              'Access-Control-Allow-Origin': '*'
          },
          success: function () {
              alert("添加笔记本成功！");
              window.location.reload();
          },
          error: function () {
              alert("添加笔记本失败！");
          }
      });
  }

  function addPage() {

      var notebookID = "<%=currentNotebook.notebookID%>";
      var notebookTitle="<%=currentNotebook.title%>"

      if(notebookID==""){
          alert("请选择笔记本！");
          $("#addPageModal").modal("hide")
          return;
      }

      $.ajax({
          data: {
              title: document.getElementById("page_title").value,
              tag: $('#page_tag').children('option:selected').val(),
              notebookID: notebookID,
              notebookTitle:notebookTitle
          },
          url: "/index/addPage",
          dataType: 'json',
//                        async: false,
          contentType: 'application/json;charset=UTF-8',
          cache: false,
          timeout: 0,
          type: 'get',    // 如果要使用GET方式，则将此处改为'get'
          headers: {
              'Access-Control-Allow-Origin': '*'
          },
          success: function () {
              alert("添加笔记成功！");
              window.location.reload();
          },
          error: function () {
              alert("添加笔记失败！");
          }
      });
  }

  function savePage(pageID) {

      var notebookID = "<%=currentNotebook.notebookID%>";

      if(notebookID==""){
          alert("请选择笔记本！");
          return;
      }

      var cookieValue = getCookieValue('pageContent');
      var temp1 = cookieValue.split("title");
      var temp2 = temp1[1].split('"%2C"');
      var temp3 = temp2[0].split('"%3A"');
      var title = temp3[1];

      $.ajax({
          data: {
              content: CKEDITOR.instances.editor1.getData(),
              title: title,
              newTitle: document.getElementById("newPageTitle").value,
              notebookID: notebookID
          },
          url: "/index/updatePage",
          dataType: 'json',
//                        async: false,
          contentType: 'application/json;charset=UTF-8',
          cache: false,
          timeout: 0,
          type: 'get',    // 如果要使用GET方式，则将此处改为'get'
          headers: {
              'Access-Control-Allow-Origin': '*'
          },
          success: function (data) {
              var result = JSON.parse(JSON.stringify(data));
              if (result.message == 'success') {
                  alert("保存笔记成功！");
//                  window.location.reload();
                  var liList = document.getElementById("pageMenu").getElementsByTagName("li");
                  for (var i = 0; i < liList.length; i++) {
                      if (liList[i].innerText.trim() == title) {
                          liList[i].innerHTML = '<a><i class="fa fa-book">&nbsp;&nbsp;' + document.getElementById("newPageTitle").value + '</i></a>'
                      }
                  }
                  document.getElementById("noteContent").innerHTML = result.page.content;
                  $("#notePanel").slideDown("slow");
                  $("#writeNotePanel").slideUp("slow");
              } else {
                  alert("保存笔记失败！请刷新重试！");
              }

          },
          error: function () {
              alert("保存笔记失败！");
          }
      });

  }

  function showPageContent(pageID) {
      $.ajax({
          data: {title:document.getElementById("page_title").value},
          url: "/index/showPageContent/"+pageID,
          dataType: 'json',
//                        async: false,
          contentType:'application/json;charset=UTF-8',
          cache: false,
          timeout: 0,
          type:'get',    // 如果要使用GET方式，则将此处改为'get'
          headers: {
              'Access-Control-Allow-Origin': '*'
          },
          success: function(data){
              var result=JSON.parse(JSON.stringify(data));
              if(result.message=='success'){
                  document.getElementById("noteContent").innerHTML = result.pageContent.content;
//                  $("#sidebar").animate({width: 'toggle'}, "slow");
                  document.getElementById("showMenuBT2").style.display='block';
                  $("#sidebar").hide();
                  $("#notePanel").slideDown("slow");
                  $("#writeNotePanel").slideUp("slow");
                  $("#main-content").animate({'margin-left': '0px'}, "slow");
                  $("#pageMenuBody").animate({'width': '18%'}, "slow");
                  $("#newPageTitle").val(result.pageContent.title);
                  CKEDITOR.instances.editor1.setData(result.pageContent.content);
                  getElementByValue(result.pageContent.title);
                  $("#sharePageBT").show();
                  $('#downloadToPdfBT').show();
                  $("#updateNoteBT").show();
                  $('#showMenuBT').hide();
              }else{
                  alert("显示笔记失败！请刷新重试！");
              }
          },
          error:function () {
              alert("显示笔记失败！请刷新重试！");
          }
      })


  }

  function showMenu() {
      $("#sidebar").show();
      $("#main-content").animate({'margin-left': '210px'}, "slow");
      $("#pageMenuBody").animate({'width': '25%'}, "slow");
      $("#showMenuBT").hide();
      $("#showMenuBT2").hide();
      $('#downloadToPdfBT').show();
      $('#sharePageBT').show();
      $("#updateNoteBT").show();
      $("#notePanel").slideDown("slow");
      $("#writeNotePanel").slideUp("slow");
      $('#backWarningModal').modal('hide');
  }

  //右击NotebookMenu
  function right(id,title,tag) {
      var e=window.event;
      if(e.button=="2"){
          document.getElementById("delete_id").innerText = id;
          document.getElementById("delete_title").innerText = title;
          $("#modify_notebookID").val(id);
          $("#modify_notebook_title").val(title);
          $("#modify_notebook_tag").val(tag);
      }
  }

  //右击PageMenu
  function right2(id,title) {
      var e=window.event;
      if(e.button=="2"){
          document.getElementById("delete_pageID").innerText = id;
          document.getElementById("delete_pageTitle").innerText = title;

      }
  }

  function setDataToDeleteNotebookDialog(){
      document.getElementById("delete_notebookID").innerText = document.getElementById("delete_id").innerText;
      document.getElementById("delete_notebookTitle").innerText = document.getElementById("delete_title").innerText;
  }

  function deleteNotebook(){
      var notebookID = document.getElementById("delete_notebookID").innerText;

      $.ajax({
          data: {notebookID: notebookID},
          url: "/index/deleteNotebook",
          dataType: 'json',
//                        async: false,
          contentType: 'application/json;charset=UTF-8',
          cache: false,
          timeout: 0,
          type: 'get',    // 如果要使用GET方式，则将此处改为'get'
          headers: {
              'Access-Control-Allow-Origin': '*'
          },
          success: function (data) {
              alert("删除成功！");
              window.location.reload();
          },
          error: function () {
              alert("删除成功！");
              window.location.reload();
          }
      });
  }

  function modifyNotebook(){
      var notebookTitle = document.getElementById("modify_notebook_title").value;
      var notebookTag = document.getElementById("modify_notebook_tag").value;
      var notebookID = document.getElementById("modify_notebookID").value;

      $.ajax({
          data: {notebookID: notebookID,title:notebookTitle,tag:notebookTag},
          url: "/index/modifyNotebook",
          dataType: 'json',
//                        async: false,
          contentType: 'application/json;charset=UTF-8',
          cache: false,
          timeout: 0,
          type: 'get',    // 如果要使用GET方式，则将此处改为'get'
          headers: {
              'Access-Control-Allow-Origin': '*'
          },
          success: function (data) {
              alert("修改成功！");
              window.location.reload();
          },
          error: function () {
              alert("修改成功！");
              window.location.reload();
          }
      });

  }

  function setDataToDeletePageDialog(){
      document.getElementById("delete_pageID2").innerText = document.getElementById("delete_pageID").innerText;
      document.getElementById("delete_pageTitle2").innerText = document.getElementById("delete_pageTitle").innerText;
  }

  function deletePage(){
      var pageID = document.getElementById("delete_pageID2").innerText;

      $.ajax({
          data: {pageID: pageID},
          url: "/index/deletePage",
          dataType: 'json',
//                        async: false,
          contentType: 'application/json;charset=UTF-8',
          cache: false,
          timeout: 0,
          type: 'get',    // 如果要使用GET方式，则将此处改为'get'
          headers: {
              'Access-Control-Allow-Origin': '*'
          },
          success: function (data) {
              alert("删除成功！");
              window.location.reload();
          },
          error: function () {
              alert("删除成功！");
              window.location.reload();
          }
      });

  }

  function getPageTags() {
      $.ajax({
          data: {},
          url: "/index/getAllPageTags",
          dataType: 'json',
//                        async: false,
          contentType: 'application/json;charset=UTF-8',
          cache: false,
          timeout: 0,
          type: 'get',    // 如果要使用GET方式，则将此处改为'get'
          headers: {
              'Access-Control-Allow-Origin': '*'
          },
          success: function (data) {
              var result = JSON.parse(JSON.stringify(data));
              if (result.message == 'success') {
                  var data = result.data;
                  for(var i=0; i<data.length;i++){
                      $("#page_tag").append(
                          "<option>"+data[i].value+ "</option>"
                      )
                  }
              } else {
                  alert("获取笔记标签信息失败！请刷新重试！");
              }
          },
          error: function () {
              alert("获取笔记标签信息失败！请刷新重试！");
              window.location.reload();
          }
      });

  }

  function addPageTag(){
      var tag = document.getElementById("page_newTag").value;
      $.ajax({
          data: {
              pageTag:tag
          },
          url: "/tagManage/addPageTag",
          dataType: 'json',
//                        async: false,
          contentType: 'application/json;charset=UTF-8',
          cache: false,
          timeout: 0,
          type: 'get',    // 如果要使用GET方式，则将此处改为'get'
          headers: {
              'Access-Control-Allow-Origin': '*'
          },
          success: function () {
              alert("添加笔记标签成功！");
              $("#addPageTagModal").modal("hide");
              $("#page_tag").append(
                  "<option>"+tag+ "</option>"
              )
          },
          error: function () {
              alert("添加笔记标签失败！");
          }
      });

  }

  function getNotebookTags() {
      $.ajax({
          data: {},
          url: "/index/getAllNotebookTags",
          dataType: 'json',
//                        async: false,
          contentType: 'application/json;charset=UTF-8',
          cache: false,
          timeout: 0,
          type: 'get',    // 如果要使用GET方式，则将此处改为'get'
          headers: {
              'Access-Control-Allow-Origin': '*'
          },
          success: function (data) {
              var result = JSON.parse(JSON.stringify(data));
              if (result.message == 'success') {
                  var data = result.data;
                  for(var i=0; i<data.length;i++){
                      $("#notebook_tag").append(
                          "<option>"+data[i].value+ "</option>"
                      )
                  }
              } else {
                  alert("获取笔记本标签信息失败！请刷新重试！");
              }
          },
          error: function () {
              alert("获取笔记本标签信息失败！请刷新重试！");
              window.location.reload();
          }
      });

  }

  function addNotebookTag(){
      var tag = document.getElementById("notebook_newTag").value;
      $.ajax({
          data: {
              notebookTag:tag
          },
          url: "/tagManage/addNotebookTag",
          dataType: 'json',
//                        async: false,
          contentType: 'application/json;charset=UTF-8',
          cache: false,
          timeout: 0,
          type: 'get',    // 如果要使用GET方式，则将此处改为'get'
          headers: {
              'Access-Control-Allow-Origin': '*'
          },
          success: function () {
              alert("添加笔记本标签成功！");
              $("#addNotebookTagModal").modal("hide");
              $("#notebook_tag").append(
                  "<option>"+tag+ "</option>"
              )
          },
          error: function () {
              alert("添加笔记本标签失败！");
          }
      });
  }

  function showFriendList(){
      $.ajax({
          data: {},
          url: "/index/getAllFriends",
          dataType: 'json',
//                        async: false,
          contentType: 'application/json;charset=UTF-8',
          cache: false,
          timeout: 0,
          type: 'get',    // 如果要使用GET方式，则将此处改为'get'
          headers: {
              'Access-Control-Allow-Origin': '*'
          },
          success: function (data) {
              var result = JSON.parse(JSON.stringify(data));
              if(result.message=='success'){
                  var data = result.data;
                  $("#friendUl").empty();
                  for(var i=0;i<data.length;i++){
                      $("#friendUl").append(
                          "<li><div class=\"task-checkbox\"><input type=\"checkbox\" class=\"list-child\"  value=\"\"  />"+
                          "</div class=\"task-title\">"+"<span id='checkFriendName' class=\"task-title-sp\">"+data[i].friendUsername+
                          "</span><p style='display: none'>"+data[i].friendID+
                          "</p></div></li>"
                      )
                  }
                  $('#friendListModal').modal('show');
                  $('.list-child').change(function() {
                      if ($(this).is(':checked')) {
                          $(this).parents('li').addClass("task-done");
                      } else {
                          $(this).parents('li').removeClass("task-done");
                      }
                  });
              }else{
                  alert("获取好友列表失败，请刷新重试！")
              }

          },
          error: function () {
              alert("获取好友列表失败，请刷新重试！");
          }
      });


  }

  function sharePage(){

      var cookie = getCookieValue("pageContent");
      var temp1 = cookie.split('"pageID"');
      var temp2 = temp1[1].split('%2C');
      var temp3 = temp2[0].split('%3A');
      var pageID = temp3[1];

      var privilege= $('#privilege_tag').children('option:selected').val();

      var usernameList=$('.task-done').children('span')
      var userIDList=$('.task-done').children('p')

      var result  =new Array();

      for(var i=0;i<usernameList.length;i++){
          var temp = {
              friendUsername: usernameList[i].innerHTML,
              friendID: userIDList[i].innerHTML
          };
          result.push(temp);
      }

      $.ajax({
          data: {userList:result,title:document.getElementById("newPageTitle").value,content:document.getElementById("noteContent").innerHTML,privilege:privilege,pageID:pageID},
          url: "/index/sharePage",
          dataType: 'json',
//                        async: false,
          contentType: 'application/json;charset=UTF-8',
          cache: false,
          timeout: 0,
          type: 'get',    // 如果要使用GET方式，则将此处改为'get'
          headers: {
              'Access-Control-Allow-Origin': '*'
          },
          success: function () {
              alert("分享成功！可以到好友圈的分享笔记中查看！");
              $('#friendListModal').modal('hide');

          },
          error: function () {
              alert("分享失败，请刷新重试！");
          }
      });


  }

</script>

<script>
    // Replace the <textarea id="editor1"> with a CKEditor
    // instance, using default configuration.
    CKEDITOR.replace( 'editor1' );

</script>

<script>

    $(document).ready(function () {
        var cookieValue = getCookieValue('user=');
        var privilege = cookieValue.substr(cookieValue.length - 2).charAt(0);
        if (privilege == 1) {
            $("#nav-accordion").append('<li>\n' +
                '          <a class="active" href="/index/userManage">\n' +
                '            <i class="fa fa-cog" aria-hidden="true"></i>\n' +
                '            <span >账户管理</span>\n' +
                '            <span class="label label-danger pull-right mail-info">2</span>\n' +
                '          </a>\n' +
                '        </li>')
        }

        document.getElementById("noteContent").innerHTML = "<%=pageContent.content%>";
    });

    function getCookieValue(key) {
        var data = decodeURI(document.cookie).split(";");
        for(var i=0;i<data.length;i++) {
            if(data[i].trim().indexOf(key)==0) {
                return data[i].trim();
            }
        }
    }

    function exportPDF(){
        var pdf = new jsPDF('p', 'mm', 'a4');
        var print_content = $('#noteContent');
        var filename = document.getElementById("newPageTitle").value+'.pdf';
        console.log($('#noteContent'));
        $('#noteContent').css("font-size", "30px")
        pdf.addHTML($('#noteContent'), function(){
            pdf.output("save", filename)
            $('#noteContent').css("font-size", "14px")
        })

    }

</script>

</body>
</html>
